<!doctype html>
<html lang="en" class="h-100">

{{element->header_app.html}}

<body class="body-scroll d-flex flex-column h-100 menu-overlay">

	<!-- Begin page content -->
	<main class="flex-shrink-0">
		<!-- Fixed navbar -->
		{{element->navheader.html}}
		<nav class="navbar navbar-light fixed-top" style="margin-top:35px;">
			<a id="return_link" class="navbar-brand" href="/index"><i style="font-size:30px;"
					class="bi bi-arrow-left-circle-fill"></i></a>
		</nav>
		<!-- page content start -->

		<div class="container mt-5" id="events_container">


		</div>

		<br />
		<br />
		<br />

		<div class="container py-3">
			{{element->navbar.html}}
		</div>

	</main>

	<script>

		window.addEventListener('load', async () => {
			const offers = await fetchOffers();
			displayOffers(offers);
		});

		const displayOffers = (offers = []) => {
			let rows = '';
			offers.map(offer => {
				rows += `
						<div class="row">
							<div class="col">
								<div style="width:100%;" class="card product-card-large mb-3" onclick="window.location.href = ('/offer?id=${offer.id}');">
									<div class="card-body p-0">
										<div class="product-image-large">
											<div class="background">
												<img style="width:100%;height:auto;" src="${offer.img || localStorage['entity_logo']}" alt="">
											</div>
										</div>
									</div>
									<div class="card-footer">
										<div class="row">
											<div class="col">
												<h6 style="font-size: 13px;" ><strong>${offer.title}</strong></h6>
											</div>
										</div>
										<div class="row">
											<div class="col">
												<div class="small text-muted">${offer.description}</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					`
			});

			document.querySelector('#events_container').innerHTML = rows;
		}

		const fetchOffers = async () => {
			try {
				const resp = await fetch(`/api/offers/harbour/${localStorage['harbour_id']}`, { method: 'GET' });
				console.log('resp', resp)
				const respJson = await resp.json();
				console.log('respJson', respJson)

				let offers = respJson.offers;
				offers = offers.sort((a, b) => (a.date_start > b.date_start) ? 1 : -1);

				return (offers);
			} catch (error) {
				console.error(error);
				alert('ERROR !');
			}
		};

	</script>

</body>
{{element->footer_app.html}}

</html>