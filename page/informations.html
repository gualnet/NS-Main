<!doctype html>
<html lang="en" class="h-100">


{{element->header_app.html}}

<body class="body-scroll d-flex flex-column h-100 menu-overlay">
	<!-- screen loader -->
	{{element->loader.html}}

	<!-- Begin page content -->
	<main class="flex-shrink-0">
		<!-- Fixed navbar -->
		{{element->navheader.html}}
		<div class="product-image-top">
			<img id="img" class="background" src="" alt="">
		</div>
		<!-- page content start -->

		<style>
			.hide {
				display: none;
			}

			#wifiCopyButton {
				overflow-wrap: break-word;
			}
		</style>

		<div class="container top-30" id="container">
			<div class="card" style="border-radius: 25px;" id="menuInfo">
				<div class="card-body" style="margin: 0 20px 0 20px">
					<div class="row">
						<div class="col" id="harbourname" style="text-align: center; font-weight: bold; color: #222">
						</div>
					</div>
				</div>
				<center>
					<div class="row">
						<div class="col" style="margin-right: -50px;">
							<a id="telcapitainerie"
								style="border-radius: 8px; background-color: #0C5BCC; border-color: #FFF0;width: 130px; height: 50px"
								class="btn"><img class="fit-picture" src="/library/call.png"
									style="width: 22px; position: relative; top: 2px;"></a>
						</div>
						<div class="col">
							<a id="mail"
								style="border-radius: 8px; background-color: #0C5BCC; border-color: #FFF0;width: 130px; height: 50px"
								class="btn"><img class="fit-picture" src="/library/mail.png"
									style="width: 27px; position: relative; top: 2px;"></a>
						</div>
					</div>
					<div class="row" style="margin-top: 10px">
						<div class="col" style="margin-right: -50px;">
							<a id="telurgence"
								style="border-radius: 8px; background-color: #0C5BCC; border-color: #FFF0;width: 130px; height: 50px"
								class="btn"><img class="fit-picture" src="/library/sos.png"
									style="width: 35px; position: relative; top: 2px;"></a>
						</div>
						<div class="col">
							<a id="hours"
								style="border-radius: 8px; background-color: #0C5BCC; border-color: #FFF0;width: 130px; height: 50px"
								class="btn" onclick="showHours();"><img class="fit-picture" src="/library/clock.png"
									style="width: 27px; position: relative; top: 2px;"></a>
						</div>
					</div>
				</center>

				<div id="gps_adress" class="card-body border-bottom border-color" style="margin: 0 20px 0 20px">
					<img class="fit-picture" src="/library/loc.png" style="width: 10px">
				</div>
				<div class="row" style="margin: 20px">
					<div class="col-6" id="website">
						<span style="font-size: 12px; color: #1D68D5">Site web</span>
					</div>
					<div class="col-6" id="touristwebsite">
						<span style="font-size: 12px; color: #1D68D5; text-align: right">Office de tourisme</span>
					</div>
					<div class="col-6" id="harbour_map">
							<span style="font-size: 12px; color: #1D68D5">Plan du port</span>
					</div>
					<div class="col-6 hide" id="price_list">
							<span style="font-size: 12px; color: #1D68D5; text-align: right">Grille tarifaire</span>
					</div>
					<div class="col-6" id="pj">
						<a id="pj_link" target="_blank" class="small vm"><span style="font-size: 12px; color: #1D68D5"
								id="pj_name"></span></a>
					</div>
				</div>
			</div>
			<div class="card" style="border-radius: 25px;" id="hoursInfo" onclick="showMenu();" hidden>
				<div class="card-header" style="margin: 0 20px 0 20px">
					<div class="row">
						<div class="col">
							<h6><i style="color: #0C5BCC !important;" class="bi bi-arrow-left"></i> Horaires - Bureau du port</h6>
						</div>
					</div>

				</div>
				<div class="card-body" style="margin: 0 20px 0 20px">
					<div class="row">
						<div class="col-6">Lundi</div>
						<div class="col-6" id="lundi" style="font-size: 15px"></div>
					</div>
					<div class="row">
						<div class="col-6">Mardi</div>
						<div class="col-6" id="mardi" style="font-size: 15px"></div>
					</div>
					<div class="row">
						<div class="col-6">Mercredi</div>
						<div class="col-6" id="mercredi" style="font-size: 15px"></div>
					</div>
					<div class="row">
						<div class="col-6">Jeudi</div>
						<div class="col-6" id="jeudi" style="font-size: 15px"></div>
					</div>
					<div class="row">
						<div class="col-6">Vendredi</div>
						<div class="col-6" id="vendredi" style="font-size: 15px"></div>
					</div>
					<div class="row">
						<div class="col-6">Samedi</div>
						<div class="col-6" id="samedi" style="font-size: 15px"></div>
					</div>
					<div class="row">
						<div class="col-6">Dimanche</div>
						<div class="col-6" id="dimanche" style="font-size: 15px"></div>
					</div>
				</div>
			</div>
			<div class="card-body border-top border-color small text-secondary">
				<br>
				<center>

					<div class="row">
						<div class="col">
							<h6 class="border-bottom border-color" style="font-weight: bold; color: #222; padding-bottom: 10px;">
								Services au port</h6><br>
						</div>
					</div>
					<div class="row" id="sanitaryButtons">
						<div class="col">
							<button id="sanitaryCodeButton" onclick="showSanitaryCode();"
								style="border-radius: 50px; background-color: #FFF; border-color: #FFF0;width: 175px; height: 50px; box-shadow: 0px 2px 16px #999">
								<span style="color: #0C5BCC">Code sanitaire</span> <img class="fit-picture" src="/library/eye.png"
									style="width: 27px; padding-left: 10px;">
							</button>
							<button id="sanitaryCode" onclick="showSanitaryButton();"
								style="border-radius: 50px; background-color: #FFF; border-color: #FFF0;width: 100%; height: 50px; box-shadow: 0px 2px 16px #999"
								hidden>
								<span style="color: #0C5BCC" id="sanitary_code"></span> <i
									style="color: #0C5BCC !important; font-size: 27px;" class="bi bi-unlock-fill"></i>
							</button>
						</div>
					</div>
					<div class="row" id="portalButtons">
						<div class="col" style="margin-top: 10px;">
							<button id="portalCodeButton" onclick="showPortalCode();"
								style="border-radius: 50px; background-color: #FFF; border-color: #FFF0;width: 175px; height: 50px; box-shadow: 0px 2px 16px #999">
								<span style="color: #0C5BCC">Code portail</span> <img class="fit-picture" src="/library/eye.png"
									style="width: 27px; padding-left: 10px;">
							</button>
							<button id="portalCode" onclick="showPortalButton();"
								style="border-radius: 50px; background-color: #FFF; border-color: #FFF0;width: 100%; height: 50px; box-shadow: 0px 2px 16px #999"
								hidden>
								<span style="color: #0C5BCC" id="portal_code"></span> <i
									style="color: #0C5BCC !important; font-size: 27px;" class="bi bi-unlock-fill"></i>
							</button>
						</div>
					</div>
					<div class="row" id="wifiButtons">
						<div class="col" style="margin-top: 10px; margin-bottom: 40px">
							<button id="wifiButton" onclick="showWifiCode();"
								style="border-radius: 50px; background-color: #0C5BCC; border-color: #FFF0;width: 175px; height: 50px; box-shadow: 0px 2px 16px #999">
								<span style="color: #FFF">Mot de passe Wi-Fi</span>
								<img class="fit-picture" src="/library/eyew.png" style="width: 27px; padding-left: 10px;">
							</button>
							<button id="wifiCopyButton" onclick="copyWifiCode();"
								style="border-radius: 50px; background-color: #0C5BCC; border-color: #FFF0; width: 100%; height: 50px; box-shadow: 0px 2px 16px #999"
								hidden>
								<span style="color: #FFF" id="wifi"></span>
								<img class="fit-picture" src="/library/copy.png" style="width: 27px; padding-left: 10px;">
							</button>
							<button id="wifiCopiedButton" onclick="showWifiButton();"
								style="border-radius: 50px; background-color: #FFF; border-color: #FFF0; width: 100%; height: 50px; box-shadow: 0px 2px 16px #999"
								hidden>
								<span style="color: #0C5BCC">Mot de passe Copi√©</span>
								<i style="width: 27px; padding-left: 10px;color:#0C5BCC;" class="bi bi-check-lg"></i>
							</button>

						</div>
					</div>
					<script>
					</script>
					<div class="row">
						<div class="col">
							<div id="vfh"><img class="fit-picture" src="/library/vhf.png" style="width: 40px; margin-right: 10px;">
							</div>
						</div>
						<div class="col">
							<div id="places"><img class="fit-picture" src="/library/place.png"
									style="width: 30px; margin-right: 10px;"></div>
						</div>
						<div class="col">
							<div id="buoy"><img class="fit-picture" src="/library/boue.png" style="width: 30px; margin-right: 10px;">
							</div>
						</div>
					</div><br>
					<div class="row">
						<div class="col">
							<div id="tirantdeau"><img class="fit-picture" src="/library/tirant.png"
									style="width: 30px; margin-right: 5px;"></div>
						</div>
						<div class="col">
							<div id="longmax"><img class="fit-picture" src="/library/longueur.png"
									style="width: 30px; margin-right: 5px;"></div>
						</div>
						<div class="col">
							<div id="electricity"><img class="fit-picture" src="/library/elec.png"
									style="width: 25px; margin-right: 10px;"></div>
						</div>
					</div><br>
					<div class="row">
						<div class="col">
							<div id="water"><img class="fit-picture" src="/library/eau.png" style="width: 25px; margin-right: 10px;">
							</div>
						</div>
						<div class="col">
							<div id="shower"><img class="fit-picture" src="/library/douche.png"
									style="width: 30px; margin-right: 10px;"></div>
						</div>
						<div class="col">
							<div id="toilet"><img class="fit-picture" src="/library/toilet.png"
									style="width: 30px; margin-right: 10px;"></div>
						</div>
					</div><br>
					<div class="row">
						<div class="col">
							<div id="fuel"><img class="fit-picture" src="/library/fuel.png" style="width: 30px; margin-right: 10px;">
							</div>
						</div>
					</div>
				</center>
			</div>
		</div>
		</div>

		<script>

			window.addEventListener('load', async () => {
				console.log('DOCUMENT LOADED')
				const harbour = await fetchHarbourData();
				console.log('FETCHED harbour',harbour)
				const user = await fetchUserSession();
				console.log('FETCHED user',user)
				displayIdentifiedUserInfos(user, harbour);

				addEventListenersToDomElements(harbour);
			});

			const isAndroidPhone = () => {
				return navigator.userAgent.toLowerCase().search("android") >= 0;
			};

			const openExternalLink = (url) => {
				if (isAndroidPhone) { // works on android devices only 
					url += '?gbOpenExternal=1';
				}
				window.open(url, '_blank');
			};

			const fetchHarbourData = async () => {
				const harbourId = localStorage['harbour_id'];
				const url = `/api/getharbour/${harbourId}`;
				const resp = await fetch(url);
				const respJson = await resp.json();
				return respJson.data;
			};

			const addEventListenersToDomElements = (harbour) => {

				const gpsAdressEl = document.querySelector("#gps_adress");
				if (gpsAdressEl) {
					let link = `https://maps.apple.com/?q=${harbour.address}`;
					if (isAndroidPhone) {
						link = `https://www.google.com/maps/?q=${harbour.address}`;
					}
					gpsAdressEl.addEventListener('click', () => {
						openExternalLink(link);
					});
					gpsAdressEl.insertAdjacentHTML('beforeend', `<span " class="small text-secondary">${harbour.address}</span>`);
				}

				const websiteBtn = document.querySelector("#website");
				console.log('websiteBtn',websiteBtn)
				if (harbour.website) {
					websiteBtn.addEventListener("click", () => {
						openExternalLink(harbour.website);
					});
				}

				const touristWebsiteBtn = document.querySelector("#touristwebsite");
				if (harbour.website) {
					touristWebsiteBtn.addEventListener('click', () => {
						openExternalLink(harbour.touristwebsite);
					});
				}

				/**@type {HTMLDivElement} */
				const priceListBtnEl = document.querySelector("#price_list");
				if (harbour.price_list && priceListBtnEl) {
					priceListBtnEl.addEventListener("click", () => {
						openExternalLink(harbour.price_list);
					});
					priceListBtnEl.classList.remove('hide');
				}

				const harbourMapBtn = document.querySelector("#harbour_map");
				if (harbour.harbour_map) {
					harbourMapBtn.addEventListener('click', () => {
						openExternalLink(harbour.harbour_map);
					});
				} else {
					harbourMapBtn.style.display = 'none';
				}
			}


			const fetchUserSession = async () => {
				const url = `/api/user/session`;
				const body = new FormData();
				body.append("token", localStorage["token"]);
				const requestOpt = {
					method: 'POST',
					body,
				};

				const resp = await fetch(url, requestOpt);
				const respJson = await resp.json();
				return respJson.data;
			};
			
			const displayIdentifiedUserInfos = (user, harbour) => {
				if (!user) {
					document.getElementById("wifiButtons").hidden = true;
					document.getElementById("sanitaryButtons").hidden = true;
					return;
				}
				document.getElementById("sanitary_code").insertAdjacentHTML('beforeend', harbour.sanitary_code);
				document.getElementById("container").innerHTML = document.getElementById("container").innerHTML.replace(/undefined/g, " ");
			}
			

			fetch("/api/getharbour/" + localStorage['harbour_id']).then(response => response.json()).then(_data => {
				const harbour = _data.data;
				if (harbour.img) {
					document.getElementById('img').src = harbour.img;
				} else {
					document.getElementById('img').src = localStorage['entity_logo'];
				}

				//document.getElementById("address").insertAdjacentHTML('beforeend', harbour.address);
				document.getElementById("buoy").insertAdjacentHTML('beforeend', harbour.buoy);
				document.getElementById("electricity").insertAdjacentHTML('beforeend', harbour.electricity);
				//document.getElementById("email").insertAdjacentHTML('beforeend', harbour.email);
				document.getElementById("fuel").insertAdjacentHTML('beforeend', harbour.fuel);
				//document.getElementById("hours").insertAdjacentHTML('beforeend', harbour.hours);
				//document.getElementById("latitude").insertAdjacentHTML('beforeend', harbour.latitude);
				//document.getElementById("longitude").insertAdjacentHTML('beforeend', harbour.longitude);
				document.getElementById("longmax").insertAdjacentHTML('beforeend', harbour.longmax);
				document.getElementById("harbourname").insertAdjacentHTML('beforeend', '<h5>' + harbour.name + '<h5>');
				//document.getElementById("telcapitainerie").insertAdjacentHTML('beforeend', harbour.phone);
				document.getElementById("telcapitainerie").href = 'tel:' + harbour.prefixed_phone;
				//document.getElementById("telurgence").insertAdjacentHTML('beforeend', harbour.phone_urgency);
				document.getElementById("telurgence").href = 'tel:' + harbour.phone_urgency;
				//document.getElementById("mail").insertAdjacentHTML('beforeend', harbour.email);
				document.getElementById("mail").href = 'mailto:' + harbour.email;
				document.getElementById("places").insertAdjacentHTML('beforeend', harbour.places);
				document.getElementById("shower").insertAdjacentHTML('beforeend', harbour.showers);
				document.getElementById("portalCode").insertAdjacentHTML('afterbegin', harbour.portal_code);
				//document.getElementById("technical_informations").insertAdjacentHTML('beforeend', harbour.technical_informations);
				document.getElementById("tirantdeau").insertAdjacentHTML('beforeend', harbour.tirantdeau);
				document.getElementById("toilet").insertAdjacentHTML('beforeend', harbour.toilet);
				document.getElementById("vfh").insertAdjacentHTML('beforeend', harbour.vfh);
				document.getElementById("water").insertAdjacentHTML('beforeend', harbour.water);
				document.getElementById("wifi").insertAdjacentHTML('beforeend', harbour.wifi_pass);
				document.getElementById("lundi").insertAdjacentHTML('beforeend', harbour.lundi);
				document.getElementById("mardi").insertAdjacentHTML('beforeend', harbour.mardi);
				document.getElementById("mercredi").insertAdjacentHTML('beforeend', harbour.mercredi);
				document.getElementById("jeudi").insertAdjacentHTML('beforeend', harbour.jeudi);
				document.getElementById("vendredi").insertAdjacentHTML('beforeend', harbour.vendredi);
				document.getElementById("samedi").insertAdjacentHTML('beforeend', harbour.samedi);
				document.getElementById("dimanche").insertAdjacentHTML('beforeend', harbour.dimanche);

				if (harbour.pj) {
					document.getElementById("pj_link").href = harbour.pj;
					document.getElementById("pj_name").innerHTML = harbour.pj_name;
				}
				else {
					document.getElementById("pj").hidden = true;
				}

				if (!harbour.wifi || harbour.wifi.length === 0) {
					document.getElementById("wifiButtons").hidden = true;
				}
				if (!harbour.sanitary_code || harbour.sanitary_code.length === 0) {
					document.getElementById("sanitaryButtons").hidden = true;
				}

				if (!harbour.portal_code || harbour.portal_code.length === 0) {
					document.getElementById("portalButtons").hidden = true;
				}

				var data = new FormData();
				data.append("token", localStorage["token"]);
			}).catch((error) => {
				console.log(error);
			});

			function showHours() {
				document.getElementById("menuInfo").hidden = true;
				document.getElementById("hoursInfo").hidden = false;
			}
			function showMenu() {
				document.getElementById("menuInfo").hidden = false;
				document.getElementById("hoursInfo").hidden = true;
			}

			function showSanitaryCode() {
				document.getElementById("sanitaryCodeButton").hidden = true;
				document.getElementById("sanitaryCode").hidden = false;
			}
			function showSanitaryButton() {
				document.getElementById("sanitaryCodeButton").hidden = false;
				document.getElementById("sanitaryCode").hidden = true;
			}

			function showPortalCode() {
				document.getElementById("portalCodeButton").hidden = true;
				document.getElementById("portalCode").hidden = false;
			}
			function showPortalButton() {
				document.getElementById("portalCodeButton").hidden = false;
				document.getElementById("portalCode").hidden = true;
			}

			function showWifiCode() {
				document.getElementById("wifiButton").hidden = true;
				document.getElementById("wifiCopyButton").hidden = false;
			}
			function showWifiButton() {
				document.getElementById("wifiButton").hidden = false;
				document.getElementById("wifiCopyButton").hidden = true;
				document.getElementById("wifiCopiedButton").hidden = true;
			}
			function copyWifiCode() {

				var data = new FormData();
				data.append("token", localStorage["token"]);
				if (localStorage['token']) {
					fetch("/api/user/session", { method: "post", body: data }).then(response => response.json()).then(_data => {
						if (_data.success) {
							//document.getElementById("sanitary_code").insertAdjacentHTML('beforeend', harbour.sanitary_code);
							//document.getElementById("wifi_pass").insertAdjacentHTML('beforeend', );
							fetch("/api/getharbour/" + localStorage['harbour_id']).then(response => response.json()).then(_data => {
								navigator.clipboard.writeText(_data.data.wifi_pass);
								document.getElementById("wifiCopyButton").hidden = true;
								document.getElementById("wifiCopiedButton").hidden = false;

								setTimeout(() => {
									document.getElementById("wifiCopyButton").hidden = false;
									document.getElementById("wifiCopiedButton").hidden = true;
								}, 1500);

							}).catch((error) => {
								console.log(error);
							})
						}
					}).catch((error) => {
						console.log(error);
					})
				}
			}
		</script>

		<div class="container py-3">
			{{element->navbar.html}}
		</div>


	</main>

	<!-- Required jquery and libraries -->
	<script src="js/jquery-3.3.1.min.js"></script>
	<script src="js/popper.min.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>

	<!-- cookie js -->
	<script src="js/jquery.cookie.js"></script>

	<!-- Swiper slider  js-->
	<script src="vendor/swiper/js/swiper.min.js"></script>

	<!-- Masonry js -->
	<script src="vendor/masonry/masonry.pkgd.min.js"></script>

	<!-- nouislider js -->
	<script src="vendor/nouislider/nouislider.min.js"></script>

	<!-- Customized jquery file  -->
	<script src="js/main.js"></script>
	<script src="js/color-scheme-demo.js"></script>

	<!-- page level custom script -->
	<script>
		"use strict"
		$(window).on('load', function () {

		});
	</script>

	<style>
		@font-face {
			font-family: 'Poppins Regular';
			font-style: normal;
			font-weight: normal;
			src: local('Poppins Regular'), url('/library/Poppins-Regular.woff') format('woff');
		}

		* {
			font-family: 'Poppins Regular' !important;
		}

		body {
			background: url("../background2.png") #FFF fixed;
			font-family: 'Poppins Regular' !important;
		}
	</style>
	{{element->footer_app.html}}

</body>
</html>